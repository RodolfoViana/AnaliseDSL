---
title: "Análise entre Mahout-Spark e DSL"
author: "Rodolfo Viana"
date: "04-09-2015"
output: html_document
---

Análise Mahout utilizando Spark, para as entradas de 10, 25, 50, 100M utilizando 0, 1, 2, 3 e 7 slaves. 


```{r,  fig.align='center', message=FALSE}
# Carrregando bibliotecas
library(dplyr)
library(ggplot2)

# Carregando dados
data <- read.csv("~/Projetos/AnaliseDSL/spark-mahout.csv")

# Transformando em númerico
data$time_in_minute <- as.numeric(gsub(",", ".", data$time_in_minute))
data$time_in_hour <- as.numeric(gsub(",", ".", data$time_in_hour))

# Agrupando por input size e slaves
by_input_slaves <- group_by(data, input_size,slaves)

# Análise do tempo em segundos
data_bySec <- summarise(by_input_slaves, mean(time_in_second))
colnames(data_bySec) <- c("input_size","slaves","time_in_second")
data_bySec$input_size <- as.factor(data_bySec$input_size)
data_bySec$slaves <- as.factor(data_bySec$slaves)

# Em minutos 

data_byMin <- summarise(by_input_slaves, mean(time_in_minute))
colnames(data_byMin) <- c("input_size","slaves","time_in_minute")
data_byMin$slaves <- as.factor(data_byMin$slaves)
data_byMin$input_size <- as.factor(data_byMin$input_size)

ggplot(data=data_byMin, aes(x=slaves, y=time_in_minute, group=input_size, colour=input_size)) +
  geom_line() + 
  geom_point() +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Mahout-Spark") +
  coord_cartesian(ylim = c(0, 550))  +
  theme(panel.background=element_blank())
```


Análise DSL, para as entradas de 10, 25, 50, 100M utilizando 0, 1, 2, 3 e slaves. 


```{r,  fig.align='center', message=FALSE}
# Carregando dados
dsl <- read.csv("~/Projetos/AnaliseDSL/dsl.csv")

# Transformando em númerico
dsl$time_in_minute <- as.numeric(gsub(",", ".", dsl$time_in_minute))
dsl$time_in_hour <- as.numeric(gsub(",", ".", dsl$time_in_hour))

# Agrupando por input size e slaves
by_input_slaves_dsl <- group_by(dsl, input_size,slaves)

# Em minutos 
data_byMin_dsl <- summarise(by_input_slaves_dsl, mean(time_in_minute))
colnames(data_byMin_dsl) <- c("input_size","slaves","time_in_minute")
data_byMin_dsl$slaves <- as.factor(data_byMin_dsl$slaves)
data_byMin_dsl$input_size <- as.factor(data_byMin_dsl$input_size)

ggplot(data=data_byMin_dsl, aes(x=slaves, y=time_in_minute, group=input_size, colour=input_size)) +
  geom_line() + 
  geom_point() + 
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "DSL") +
  coord_cartesian(ylim = c(0, 550))  +
  theme(panel.background=element_blank())
```


Essa análise foi criada com o intuito de comparar as execuções utilizando a DSL com a execução utilizando Mahout-Spark.

```{r, warning=FALSE, fig.align='center', message=FALSE}
data <- read.csv("~/Projetos/AnaliseDSL/mahout_and_dsl.csv")
data$time_in_minute <- as.numeric(gsub(",", ".", data$time_in_minute))
data$time_in_hour <- as.numeric(gsub(",", ".", data$time_in_hour))
data$input_size <- as.factor(data$input_size)
data$slaves <- as.factor(data$slaves)

dsl <- data %>%
  filter(is_dsl == 1)

mahout <- data %>%
  filter(is_dsl == 0)

dsl_10 <- dsl %>%
  filter(input_size == 10) 

mahout_10 <- mahout %>%
  filter(input_size == 10)

# Agrupando por input size e slaves
by_input_slaves_mahout <- group_by(mahout_10, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_mahout <- summarise(by_input_slaves_mahout, mean(time_in_minute))
colnames(data_byMinute_mahout) <- c("input_size","slaves","time_in_minute")
data_byMinute_mahout$execução <- "Mahout"

# Agrupando por input size e slaves
by_input_slaves_dsl <- group_by(dsl_10, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_dsl <- summarise(by_input_slaves_dsl, mean(time_in_minute))
colnames(data_byMinute_dsl) <- c("input_size","slaves","time_in_minute")
data_byMinute_dsl$execução <- "DSL"

input10 <- rbind(data_byMinute_dsl, data_byMinute_mahout)

ggplot(input10, aes(x = slaves, y=time_in_minute, colour = execução )) + 
  geom_point( aes(shape=execução ),  size = 4 ) +
  coord_cartesian(ylim = c(0, max(input10$time_in_minute)+3))  +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Input de 10M") +
  theme(panel.background=element_blank())
```

Análise para o input de 25M

```{r, fig.align='center'}
dsl_25 <- dsl %>%
  filter(input_size == 25) 

mahout_25 <- mahout %>%
  filter(input_size == 25)

# Agrupando por input size e slaves
by_input_slaves_mahout <- group_by(mahout_25, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_mahout <- summarise(by_input_slaves_mahout, mean(time_in_minute))
colnames(data_byMinute_mahout) <- c("input_size","slaves","time_in_minute")
data_byMinute_mahout$execução <- "Mahout"

# Agrupando por input size e slaves
by_input_slaves_dsl <- group_by(dsl_25, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_dsl <- summarise(by_input_slaves_dsl, mean(time_in_minute))
colnames(data_byMinute_dsl) <- c("input_size","slaves","time_in_minute")
data_byMinute_dsl$execução <- "DSL"

input25 <- rbind(data_byMinute_dsl, data_byMinute_mahout)

ggplot(input25, aes(x = slaves, y=time_in_minute, colour = execução)) + 
  geom_point( aes(shape=execução),  size = 4 ) +
  coord_cartesian(ylim = c(0, max(input25$time_in_minute)+10))  +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Input de 25M") +
  theme(panel.background=element_blank())
```

Análise para o input de 50M

```{r, fig.align='center'}
dsl_50 <- dsl %>%
  filter(input_size == 50) 

mahout_50 <- mahout %>%
  filter(input_size == 50)

# Agrupando por input size e slaves
by_input_slaves_mahout <- group_by(mahout_50, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_mahout <- summarise(by_input_slaves_mahout, mean(time_in_minute))
colnames(data_byMinute_mahout) <- c("input_size","slaves","time_in_minute")
data_byMinute_mahout$execução <- "Mahout"

# Agrupando por input size e slaves
by_input_slaves_dsl <- group_by(dsl_50, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_dsl <- summarise(by_input_slaves_dsl, mean(time_in_minute))
colnames(data_byMinute_dsl) <- c("input_size","slaves","time_in_minute")
data_byMinute_dsl$execução <- "DSL"

input50 <- rbind(data_byMinute_dsl, data_byMinute_mahout)


ggplot(input50, aes(x = slaves, y=time_in_minute, colour = execução )) + 
  geom_point( aes(shape=execução ),  size = 4 ) +
  coord_cartesian(ylim = c(0, max(input50$time_in_minute)+20))  +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Input de 50M") +
  theme(panel.background=element_blank())
```

Análise para o input de 100M

```{r, fig.align='center'}
dsl_100 <- dsl %>%
  filter(input_size == 100) 

mahout_100 <- mahout %>%
  filter(input_size == 100)

# Agrupando por input size e slaves
by_input_slaves_mahout <- group_by(mahout_100, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_mahout <- summarise(by_input_slaves_mahout, mean(time_in_minute))
colnames(data_byMinute_mahout) <- c("input_size","slaves","time_in_minute")
data_byMinute_mahout$execução <- "Mahout"

# Agrupando por input size e slaves
by_input_slaves_dsl <- group_by(dsl_100, input_size,slaves)

# Análise do tempo em segundos
data_byMinute_dsl <- summarise(by_input_slaves_dsl, mean(time_in_minute))
colnames(data_byMinute_dsl) <- c("input_size","slaves","time_in_minute")
data_byMinute_dsl$execução <- "DSL"

input100 <- rbind(data_byMinute_dsl, data_byMinute_mahout)


ggplot(input100, aes(x = slaves, y=time_in_minute, colour = execução )) + 
  geom_point( aes(shape=execução ),  size = 4 ) +
  coord_cartesian(ylim = c(0, max(input100$time_in_minute)+20))  +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Input de 100M") +
  theme(panel.background=element_blank())

#input <- rbind(input10, input50, input25, input100)

#ggplot(input, aes(x = slaves, y=time_in_minute, colour = execução, size=input_size )) + 
#  geom_point() +
#  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Todas as entradas") +
#  theme(panel.background=element_blank())

```

Todos os pontos

```{r, warning=FALSE, fig.align='center', message=FALSE}
data <- read.csv("~/Projetos/AnaliseDSL/mahout_and_dsl.csv")
data$time_in_minute <- as.numeric(gsub(",", ".", data$time_in_minute))
data$time_in_hour <- as.numeric(gsub(",", ".", data$time_in_hour))
data$input_size <- as.factor(data$input_size)
data$slaves <- as.factor(data$slaves)

dsl <- data %>%
  filter(is_dsl == 1)

mahout <- data %>%
  filter(is_dsl == 0)

dsl_10 <- dsl %>%
  filter(input_size == 10) 

mahout_10 <- mahout %>%
  filter(input_size == 10)

mahout_10 <- mahout_10[sample(1:nrow(mahout_10), 5),]

mahout_10$execução <- "Mahout"
dsl_10$execução <- "DSL"

input10 <- rbind(dsl_10 , mahout_10)

ggplot(input10, aes(x = slaves, y=time_in_minute, colour = execução )) + 
  geom_point(  ) +
  coord_cartesian(ylim = c(0, max(input10$time_in_minute)+3))  +
  labs(y='Média dos tempos em minutos', x='Número de slaves', title = "Input de 10M") +
  theme(panel.background=element_blank())
```

Com intervalor de confiança

```{r, warning=FALSE, fig.align='center', message=FALSE}
data <- read.csv("~/Projetos/AnaliseDSL/mahout_and_dsl.csv")
data$time_in_minute <- as.numeric(gsub(",", ".", data$time_in_minute))
data$time_in_hour <- as.numeric(gsub(",", ".", data$time_in_hour))
data$input_size <- as.factor(data$input_size)
data$slaves <- as.factor(data$slaves)

dsl <- data %>%
  filter(is_dsl == 1)

mahout <- data %>%
  filter(is_dsl == 0)

dsl_10 <- dsl %>%
  filter(input_size == 10) %>%
  filter(slaves == 0)

mahout_10 <- mahout %>%
  filter(input_size == 10)  %>%
  filter(slaves == 0)

mahout_10 <- mahout_10[sample(1:nrow(mahout_10), 5),]

mahout_10_1 <- mahout %>%
  filter(input_size == 10)  %>%
  filter(slaves == 1)

mahout_10_1 <- mahout_10_1[sample(1:nrow(mahout_10_1), 5),]

dsl_10_2 <- dsl %>%
  filter(input_size == 10) %>%
  filter(slaves == 2)

mahout_10_2 <- mahout %>%
  filter(input_size == 10)  %>%
  filter(slaves == 2)

mahout_10_2 <- mahout_10_2[sample(1:nrow(mahout_10_2), 5),]

dsl_10_3 <- dsl %>%
  filter(input_size == 10) %>%
  filter(slaves == 3)

mahout_10_3 <- mahout %>%
  filter(input_size == 10)  %>%
  filter(slaves == 3)

mahout_10_3 <- mahout_10_3[sample(1:nrow(mahout_10_3), 5),]

testdsl_10 <- t.test(dsl_10$time_in_minute)
testmahout_10 <- t.test(mahout_10$time_in_minute)
ic_1 = c(testdsl_10 $conf.int[1],testdsl_10 $conf.int[2])
ic_2 = c(testmahout_10$conf.int[1],testmahout_10$conf.int[2])

mahout_10$execução <- "Mahout"
dsl_10$execução <- "DSL"

samples <- rbind(dsl_10,mahout_10)

toPlot <- summarise(group_by(samples, execução, input_size,slaves), mean = mean(time_in_minute))
toPlot$lower <- c(ic_1[1],ic_2[1])
toPlot$upper <- c(ic_1[2],ic_2[2])


testdsl_10 <- t.test(dsl_10_2$time_in_minute)
testmahout_10 <- t.test(mahout_10_2$time_in_minute)
ic_1 = c(testdsl_10 $conf.int[1],testdsl_10 $conf.int[2])
ic_2 = c(testmahout_10$conf.int[1],testmahout_10$conf.int[2])

mahout_10_2$execução <- "Mahout"
dsl_10_2$execução <- "DSL"

samples <- rbind(dsl_10_2,mahout_10_2)

toPlot_1 <- summarise(group_by(samples, execução, input_size,slaves), mean = mean(time_in_minute))
toPlot_1$lower <- c(ic_1[1],ic_2[1])
toPlot_1$upper <- c(ic_1[2],ic_2[2])

testdsl_10 <- t.test(dsl_10_3$time_in_minute)
testmahout_10 <- t.test(mahout_10_3$time_in_minute)
ic_1 = c(testdsl_10 $conf.int[1],testdsl_10 $conf.int[2])
ic_2 = c(testmahout_10$conf.int[1],testmahout_10$conf.int[2])

mahout_10_3$execução <- "Mahout"
dsl_10_3$execução <- "DSL"

samples <- rbind(dsl_10_3,mahout_10_3)

toPlot_2 <- summarise(group_by(samples, execução, input_size,slaves), mean = mean(time_in_minute))
toPlot_2$lower <- c(ic_1[1],ic_2[1])
toPlot_2$upper <- c(ic_1[2],ic_2[2])


toPlot_3 <- rbind(toPlot_1,toPlot, toPlot_2)

ggplot(toPlot_3, aes(x = slaves, y=mean, colour = execução )) + 
  geom_point() +
  geom_errorbar(aes(ymin=lower, ymax=upper), width=.1) +
  labs(y='Média do tempo em min', x='Número de slaves') +
  theme(panel.background=element_blank())
```